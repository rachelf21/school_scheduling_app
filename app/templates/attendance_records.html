{% extends "base-denied.html" %} {% block title %} MDY Attendance Records {% endblock %} {% block content %}

<script src="/static/js/records.js"></script>

<!-- <div id="outerdiv" style="display: flex; text-align: center">
  <div id="innerdiv" style="margin-left: auto; margin-right: auto"> -->
<div style="text-align: center">
  <h1 id="h1" class="mb-0 font-weight-normal">Attendance Records</h1>
  <hr />
  <p></p>
  <h2 id="page_title" class="font-weight-normal mt-0 text-center"></h2>
  <h2 class="font-weight-normal mb-2">
    <div style="display: flex; justify-content: center">
      <div><span class="text-muted small"> ABSENCES </span> <span style="color: red" class="mr-4">{{absences}}</span></div>
      <div><span class="text-muted small ml-4"> LATE </span> <span style="color: blue">{{lates}}</span></div>
    </div>
  </h2>
</div>
<script>
  var title = "";
  var category = "{{category}}";
  console.log("category", category);
  if (category == "class") {
    title = "{{courseid}}";
  } else if (category == "student") {
    title = "{{student_name}}<br> {{student_class}}";
  } else if (category == "date") {
    title = "{{date}}";
  } else if (category == "classdate") {
    title = "{{courseid}}" + "<br>{{date}}";
  } else if (category.substring(0, 2) == "_x") {
    title = "{{courseid}}" + "<br>{{date}}";
  } else {
    title = "{{student_name}} <br> {{student_class}}";
  }
  console.log("Title", title);
  document.getElementById("page_title").innerHTML = title;
  hideCover();
</script>

<div class="table-responsive">
  <table
    id="myTable"
    class="table mx-auto w-auto table-striped table-hover table-bordered table-fixed mb-4"
    style="border: 0px red solid; width: auto; margin: 0px auto"
  >
    <thead class="small">
      <th>Date</th>
      <th>Pd</th>
      <th>Class</th>
      <th>Subject</th>
      <th>Name</th>
      <th class="text-center">St</th>
      <th>Comments</th>
      <th>Edit</th>
    </thead>
    <tbody>
      {% for att in attendance %}
      <tr>
        <td>
          <script>
            var date = "{{ att.att_date}}".substring(5, 10);

            var class_ = "{{ att.courseid}}".substring(0, 5);
            {% if loop.nextitem is defined  %}
              var next_class = "{{attendance[loop.index].courseid}}".substring(0, 5);
              //console.log("current class = " + class_ + " and next class =" + next_class);
              if (class_!=next_class){
                //console.log("new class below");
                var element = document.currentScript.parentElement.parentElement;
                element.style.borderBottomStyle = "solid"
                element.style.borderBottomWidth="thick";
                element.setAttribute('class', 'mb-4');
              }
            {% endif %}
            if (date.substring(0, 1) == 0) date = date.substring(1, 5);
            document.write(date);
          </script>
        </td>
        <td>
          <script>
            var sched = "{{ att.scheduleid}} ";
            sched = sched.substring(2, sched.length);
            document.write(sched);
          </script>
        </td>
        <td class="text-center">
          <script>
            document.write(class_);
          </script>
        </td>

        <td>
          <script>
            document.write("{{ att.courseid}}".substring(6));
          </script>
        </td>
        <td class="text-nowrap"><a style="color: black" href="/track_attendance/{{ att.email}}" target="_blank">{{ att.name}}</a></td>
        <td class="text-center">
          <script>
            current_student_status = "{{att.status}}";
            var parent = document.currentScript.parentElement;
            if (current_student_status == "A") {
              parent.style.color = "red";
            } else if (current_student_status == "L") {
              parent.style.color = "blue";
            } else if (current_student_status == "P") {
              parent.style.color = "rgb(14, 173, 56)";
            }
            document.write(current_student_status);
          </script>
        </td>
        <td>{{ att.comment}}</td>
        <td>
          <a
            class="a btn-sm mt-2 mb-1 form-control-sm"
            onclick='edit_attendance("{{loop.index}}", "{{ att.att_date}}","{{ att.courseid}}", "{{ att.email}}","{{att.name}}", "{{ att.status}}", "{{ att.comment}}"  )'
            ><i class="fa fa-pencil" aria-hidden="true"></i
          ></a>

          <button id="show-button" style="display: none" /><i class="fa fa-pencil" aria-hidden="true"></i>
          <div id="prompt-form-container" style="display: none">
            <form id="prompt-form">
              <div id="prompt-message"></div>
              <input name="status" type="text" />
              <input name="comment" type="text" />
              <input type="submit" value="Ok" />
              <input type="button" name="cancel" value="Cancel" />
            </form>
          </div>
        </td>
      </tr>

      {%endfor%}
    </tbody>
  </table>
  <div style="text-align: center">
    <a id="my_classes" href="/classes_anon" class="mt-2 mb-2 mr-4 btn btn-primary btn-md">My Classes</a>
  </div>
  <script>
    console.log("{{current_user}}");
    if ("{{current_user}}" == "rfriedman") {
      element = document.getElementById("my_classes");
      element.href = "/today";
    }
  </script>
</div>
<!-- </div>
</div> -->
<hr class="mb-4" />
<script>
  $("#myTable").DataTable({
    ordering: true,
    //order: [[1, "asc"]],
    pageLength: 20,
    paging: true,
    filter: true,
    //deferRender: true,
    //scrollY: 1200,
    scrollCollapse: true,
    scroller: true,
    select: true,
    bSort: false,
  });

  document.getElementById("show-button").onclick = function () {
    showPrompt("Enter updated Status<br> A, L, P", function (value) {
      alert("You entered: " + value);
    });
  };
</script>
{% endblock content %}
